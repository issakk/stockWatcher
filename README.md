# 股票指数监视器

一个用Go语言编写的股票指数监视程序，实时监控上证指数(sh000001)的波动情况，当波动幅度超过设定阈值时通过企业微信机器人发送通知。

## 功能特性

- 📊 **实时监控**: 监控上证指数实时的价格变动
- 🎯 **智能阈值**: 可自定义波动阈值，默认0.8%
- 📱 **企微通知**: 通过企业微信机器人发送实时警报
- ⚡ **防重复**: 智能避免频繁发送重复通知
- 📈 **统计信息**: 显示当日最大波动和当前波动情况
- ⚙️ **灵活配置**: 支持YAML配置文件，易于修改参数

## 项目结构

```
stockWatcher/
├── main.go                    # 主程序入口
├── config.yaml               # 配置文件
├── go.mod                    # Go模块文件
└── internal/
    ├── config/               # 配置管理
    │   └── config.go
    ├── monitor/              # 监控逻辑
    │   ├── monitor.go
    │   └── fetcher.go
    ├── notifier/             # 通知功能
    │   └── wechat.go
    └── models/               # 数据模型
        ├── stock.go
        └── config.go
```

## 快速开始

### 1. 配置企业微信机器人

1. 在企业微信群中添加机器人
2. 复制机器人的Webhook URL
3. 编辑 `config.yaml` 文件，将Webhook URL填入 `wechat.webhook_url` 字段

### 2. 配置监控参数

编辑 `config.yaml` 文件：

```yaml
# 股票配置
stock:
  code: "sh000001"        # 上证指数代码
  name: "上证指数"        # 股票名称
  threshold: 0.8          # 波动阈值(百分比)，0.8表示0.8%

# 企业微信机器人配置
wechat:
  webhook_url: "https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=YOUR_KEY"

# 监视器配置
monitor:
  interval: 30s          # 检查间隔
```

### 3. 运行程序

```bash
# 编译程序
go build -o stockWatcher main.go

# 运行程序
./stockWatcher
```

或者直接运行：

```bash
go run main.go
```

## 配置说明

### 股票配置 (stock)

- `code`: 股票代码，支持 sh000001(上证指数)、sz399001(深证成指)、sz399006(创业板指)
- `name`: 股票名称，用于显示
- `threshold`: 波动阈值，当从开盘价的波动幅度超过此值时触发通知

### 企业微信配置 (wechat)

- `webhook_url`: 企业微信机器人的Webhook URL，**必须配置**

### 监视器配置 (monitor)

- `interval`: 检查间隔，支持时间单位：s(秒)、m(分钟)、h(小时)

## 通知示例

当触发警报时，会发送类似以下格式的消息：

```
📉 股市波动警报 📉

📊 指数：上证指数
💰 当前：3125.67
📈 涨跌：下跌 1.24% (-39.12点)
📅 开盘：3164.79
🔼 最高：3172.45
🔽 最低：3120.33
⏰ 时间：14:35:20
🎯 波动阈值：0.80%

📝 当日波动统计：
• 最大波动：1.35%%
• 当前波动：1.24%

请注意风险控制！
```

## 防重复通知机制

程序包含智能防重复通知机制：

1. **时间间隔**: 两次通知间隔至少5分钟
2. **波动增加**: 如果波动幅度继续显著增加(增加0.2%以上)，仍然会发送通知
3. **当日统计**: 显示当日最大波动和当前波动情况

## 系统要求

- Go 1.16+
- 网络连接（用于获取股票数据和发送通知）
- 企业微信群和机器人

## 故障排除

### 1. 配置文件不存在

首次运行时如果配置文件不存在，程序会自动创建默认配置文件，请填写企业微信Webhook URL后重新启动。

### 2. 网络连接问题

确保程序能够访问：
- 新浪财经API (用于获取股票数据)
- 企业微信API (用于发送通知)

### 3. 企业微信配置错误

检查Webhook URL是否正确，可以在企业微信机器人设置页面重新获取。

## 开发说明

### 依赖库

- `gopkg.in/yaml.v3`: YAML配置文件解析
- Go标准库：`net/http`、`time`、`log`、`sync`等

### 扩展功能

程序采用模块化设计，可以轻松扩展：

- 添加新的通知方式（邮件、短信等）
- 支持更多股票指数
- 增加数据分析功能
- 添加Web界面

## 许可证

MIT License