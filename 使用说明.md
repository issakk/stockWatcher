# 股票指数监视器使用说明

## 项目概述

这是一个用Go语言开发的股票指数监视程序，专门用于监控上证指数(sh000001)的实时波动情况。当指数从开盘价的波动幅度超过设定的阈值时，程序会通过企业微信机器人发送实时通知。

## 核心功能

- ✅ **实时数据获取**: 通过新浪财经API获取上证指数实时数据
- ✅ **智能波动计算**: 计算相对于开盘价的波动百分比
- ✅ **企业微信通知**: 当波动超过阈值时自动发送通知
- ✅ **防重复机制**: 避免频繁发送相同警报
- ✅ **配置灵活**: 支持YAML配置文件，可自定义参数
- ✅ **模拟数据**: 当API不可用时自动切换到模拟数据进行测试

## 快速开始

### 1. 配置企业微信机器人

**步骤1**: 在企业微信群中添加机器人
- 打开企业微信群 → 点击右上角"..." → 添加机器人
- 设置机器人名称 → 获取Webhook URL

**步骤2**: 编辑配置文件
```bash
# 编辑 config.yaml 文件
vim config.yaml
```

填入你的企业微信机器人URL：
```yaml
wechat:
  webhook_url: "https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=你的实际密钥"
```

### 2. 设置监控参数

```yaml
stock:
  code: "sh000001"        # 上证指数代码
  name: "上证指数"        # 股票名称
  threshold: 0.8          # 波动阈值(百分比)，0.8表示0.8%

monitor:
  interval: 30s          # 检查间隔
```

### 3. 运行程序

```bash
# 方式1: 直接运行
go run main.go

# 方式2: 编译后运行
go build -o stockWatcher main.go
./stockWatcher
```

## 配置详解

### 股票配置 (stock)
- `code`: 股票代码，支持：
  - `sh000001`: 上证指数
  - `sz399001`: 深证成指
  - `sz399006`: 创业板指
- `name`: 股票名称，用于通知显示
- `threshold`: 波动阈值，当从开盘价波动超过此值时触发通知

### 企业微信配置 (wechat)
- `webhook_url`: **必须配置**，企业微信机器人的Webhook URL

### 监视器配置 (monitor)
- `interval`: 检查间隔，支持时间单位：
  - `30s`: 30秒
  - `1m`: 1分钟
  - `5m`: 5分钟

## 通知示例

当触发警报时，企业微信会收到如下格式的消息：

```
📉 股市波动警报 📉

📊 指数：上证指数
💰 当前：3125.67
📈 涨跌：下跌 1.24% (-39.12点)
📅 开盘：3164.79
🔼 最高：3172.45
🔽 最低：3120.33
⏰ 时间：14:35:20
🎯 波动阈值：0.80%

📝 当日波动统计：
• 最大波动：1.35%%
• 当前波动：1.24%

请注意风险控制！
```

## 智能防重复机制

程序采用智能防重复通知策略：

1. **时间间隔控制**: 两次通知间隔至少5分钟
2. **波动持续跟踪**: 如果波动继续显著增加(>+0.2%)，仍然会发送通知
3. **当日统计**: 显示当日最大波动和当前波动情况

## 测试模式

当网络API不可用时，程序会自动切换到模拟数据模式，确保程序正常运行和测试。

## 系统要求

- Go 1.16+
- 稳定的网络连接
- 企业微信账号和机器人

## 故障处理

### 常见问题

**Q: 程序启动提示"企业微信webhookURL不能为空"**
A: 请在config.yaml中正确配置企业微信机器人的Webhook URL

**Q: 获取数据失败**
A: 程序会自动切换到模拟数据模式，确保程序正常运行

**Q: 收不到企业微信通知**
A: 检查Webhook URL是否正确，机器人是否仍在群中

### 日志查看

程序运行时会输出详细日志：
```
2025/10/17 14:35:46 股票指数监视器启动...
2025/10/17 14:35:46 监视指数: sh000001
2025/10/17 14:35:46 波动阈值: 0.80%
2025/10/17 14:35:46 检查间隔: 30s
2025/10/17 14:35:46 初始数据: 上证指数 当前: 3125.67 开盘: 3164.79
2025/10/17 14:36:16 上证指数: 当前 3125.67 开盘 3164.79 波动 -1.24% (开盘基准)
```

## 安全注意事项

1. **保护Webhook URL**: 不要将企业微信机器人的Webhook URL泄露给他人
2. **合理设置阈值**: 建议设置合理的波动阈值，避免过多或过少的通知
3. **监控资源使用**: 长期运行时注意程序的CPU和网络使用情况

## 扩展开发

程序采用模块化设计，可以轻松扩展：

- 支持更多股票指数
- 添加新的通知方式（邮件、短信等）
- 增加数据分析和图表功能
- 开发Web管理界面

## 许可证

本项目采用MIT许可证，欢迎使用和修改。